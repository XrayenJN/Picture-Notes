{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Jonathan\\\\Desktop\\\\MERNstack\\\\project\\\\Picture-Notes\\\\client\\\\src\\\\components\\\\admin-dashboard.component.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport { Link } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst token = localStorage.getItem('token');\nconst header = {\n  headers: {\n    'auth-token': token\n  }\n};\nexport default class AdminDashboard extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      users: [],\n      subjects: [],\n      details: [],\n      photos: []\n    };\n    this.updateState = this.updateState.bind(this);\n  }\n\n  componentDidMount() {\n    axios.get('/api/users').then(res => {\n      this.setState({\n        users: res.data\n      });\n    });\n    axios.get('/api/dashboard/subjects', header).then(res => {\n      this.setState({\n        subjects: res.data\n      });\n    });\n    axios.get('/api/dashboard/details', header).then(res => {\n      this.setState({\n        details: res.data\n      });\n    });\n    axios.get('/api/dashboard/img_data', header).then(res => {\n      console.log(res.data);\n      this.setState({\n        photos: res.data\n      });\n    });\n  }\n\n  deleteDetail(e, id, imgID) {\n    e.preventDefault(); // axios.delete('/dashboard/details/' + id, header)\n    //     .then(res => console.log(res.data))\n    // axios.delete('/dashboard/img_data/' + imgID, header)\n    //     .then(res => console.log(res.data));\n\n    console.log(id, imgID); // this.setState({ \n    //     details: this.state.details.filter(each => each._id !== id),\n    //     photos: this.state.photos.filter(each => each._id !== imgID)\n    // })\n  }\n\n  updateState(detailID, imgID) {\n    this.setState({\n      details: this.state.details.filter(each => each._id !== detailID),\n      photos: this.state.photos.filter(each => each._id !== imgID)\n    });\n  }\n\n  render() {\n    const users = this.state.users;\n    const subjects = this.state.subjects;\n    const details = this.state.details;\n    const photos = this.state.photos;\n\n    function arrayBufferToBase64(buffer) {\n      var binary = '';\n      var bytes = [].slice.call(new Uint8Array(buffer));\n      bytes.forEach(b => binary += String.fromCharCode(b));\n      return window.btoa(binary);\n    }\n\n    ;\n\n    function deleteDetail(e, id, imgID) {\n      e.preventDefault();\n      axios.delete('/dashboard/details/' + id, header).then(res => console.log(res.data));\n      axios.delete('/dashboard/img_data/' + imgID, header).then(res => console.log(res.data));\n      alert(\"Detail has been deleted. Please refresh to update the dashboard.\");\n      document.getElementById('info').innerHTML = \"x\";\n    }\n\n    function Detail(props) {\n      const detail = details.filter(detail => detail.username === props.user && detail.subject === props.subject).map(detail => {\n        try {\n          var imageID = detail.image;\n          const image = photos.filter(img => img._id === imageID);\n          const base64Flag = 'data:image/jpeg;base64,';\n          const imageStr = arrayBufferToBase64(image[0].img.data.data);\n          var actualImage = base64Flag + imageStr;\n        } catch {\n          actualImage = '';\n        }\n\n        return /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"w-25 p-3\",\n            children: detail.description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"w-25 p-3\",\n            children: detail.date.substring(0, 10)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"w-25 p-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"a\", {\n              className: \"lightbox\",\n              href: `#${actualImage}`,\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: actualImage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 120,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lightbox-target\",\n              id: actualImage,\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: actualImage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 123,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"lightbox-close\",\n                href: \"#\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 124,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"w-25 p-3\",\n            children: [/*#__PURE__*/_jsxDEV(Link, {\n              to: \"/admin/dashboard/detail/edit/\" + detail._id,\n              children: \"edit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 33\n            }, this), \"|\", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"/admin/dashboard\",\n              onClick: e => deleteDetail(e, detail._id, imageID),\n              children: \"delete\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 33\n            }, this), \"  \", /*#__PURE__*/_jsxDEV(\"a\", {\n              id: \"info\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 127\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 29\n          }, this)]\n        }, detail._id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 25\n        }, this);\n      });\n      return detail;\n    }\n\n    function Subject(props) {\n      const subject = subjects.filter(subject => subject.username === props.user).map(subject => /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          children: subject.subject\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"table\",\n          children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: /*#__PURE__*/_jsxDEV(Detail, {\n              user: props.user,\n              subject: subject.subject\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 25\n        }, this)]\n      }, subject._id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 21\n      }, this));\n      return subject;\n    }\n\n    const user = users.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: user.username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Subject, {\n        user: user.username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }, this)]\n    }, user.username, true, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }, this));\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: \"center\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(Link, {\n          to: \"/admin/user/add\",\n          children: \"+User\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/admin/subject/add\",\n          children: \"+Subject\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/admin/detail/add\",\n          children: \"+Detail\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }, this), user]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Jonathan/Desktop/MERNstack/project/Picture-Notes/client/src/components/admin-dashboard.component.js"],"names":["React","Component","axios","Link","token","localStorage","getItem","header","headers","AdminDashboard","constructor","props","state","users","subjects","details","photos","updateState","bind","componentDidMount","get","then","res","setState","data","console","log","deleteDetail","e","id","imgID","preventDefault","detailID","filter","each","_id","render","arrayBufferToBase64","buffer","binary","bytes","slice","call","Uint8Array","forEach","b","String","fromCharCode","window","btoa","delete","alert","document","getElementById","innerHTML","Detail","detail","username","user","subject","map","imageID","image","img","base64Flag","imageStr","actualImage","description","date","substring","Subject","textAlign"],"mappings":"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","sourcesContent":["\r\nimport React, { Component } from 'react';\r\nimport axios from 'axios';\r\nimport { Link } from 'react-router-dom';\r\n\r\nconst token = localStorage.getItem('token');\r\nconst header = { headers: {'auth-token': token} }\r\n\r\nexport default class AdminDashboard extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            users: [],\r\n            subjects: [],\r\n            details: [],\r\n            photos: []\r\n        };\r\n\r\n        this.updateState = this.updateState.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        axios.get('/api/users')\r\n            .then(res => {\r\n                this.setState({ users: res.data })\r\n            })\r\n\r\n        axios.get('/api/dashboard/subjects', header)\r\n          .then(res => {\r\n              this.setState({ subjects: res.data })\r\n          })\r\n\r\n        axios.get('/api/dashboard/details', header)\r\n            .then(res => {\r\n                this.setState({ details: res.data })\r\n            })\r\n\r\n        axios.get('/api/dashboard/img_data', header)\r\n            .then(res => {\r\n                console.log(res.data)\r\n                this.setState({ photos: res.data })\r\n            })\r\n    }\r\n\r\n    deleteDetail(e, id, imgID) {\r\n        e.preventDefault();\r\n\r\n        // axios.delete('/dashboard/details/' + id, header)\r\n        //     .then(res => console.log(res.data))\r\n\r\n        // axios.delete('/dashboard/img_data/' + imgID, header)\r\n        //     .then(res => console.log(res.data));\r\n\r\n        console.log(id, imgID)\r\n\r\n        // this.setState({ \r\n        //     details: this.state.details.filter(each => each._id !== id),\r\n        //     photos: this.state.photos.filter(each => each._id !== imgID)\r\n        // })\r\n    }\r\n\r\n    updateState(detailID, imgID) {\r\n        this.setState({ \r\n            details: this.state.details.filter(each => each._id !== detailID),\r\n            photos: this.state.photos.filter(each => each._id !== imgID)\r\n        })\r\n    }\r\n\r\n    render() {\r\n        const users = this.state.users;\r\n        const subjects = this.state.subjects;\r\n        const details = this.state.details;\r\n        const photos = this.state.photos;\r\n\r\n        function arrayBufferToBase64(buffer) {\r\n            var binary = '';\r\n            var bytes = [].slice.call(new Uint8Array(buffer));\r\n            bytes.forEach((b) => binary += String.fromCharCode(b));\r\n            return window.btoa(binary);\r\n        };\r\n\r\n        function deleteDetail(e, id, imgID) {\r\n            e.preventDefault();\r\n\r\n            axios.delete('/dashboard/details/' + id, header)\r\n                .then(res => console.log(res.data))\r\n\r\n            axios.delete('/dashboard/img_data/' + imgID, header)\r\n                .then(res => console.log(res.data));\r\n\r\n            alert(\"Detail has been deleted. Please refresh to update the dashboard.\")\r\n            document.getElementById('info').innerHTML = \"x\";\r\n        }\r\n\r\n        function Detail(props) {\r\n            const detail =\r\n            details\r\n                .filter( detail => \r\n                    detail.username === props.user \r\n                    && detail.subject === props.subject\r\n                )\r\n                .map( detail => {\r\n                    try{\r\n                        var imageID = detail.image\r\n                        const image = photos.filter(img => img._id === imageID)\r\n                        const base64Flag = 'data:image/jpeg;base64,';\r\n                        const imageStr = arrayBufferToBase64(image[0].img.data.data)\r\n                        var actualImage = base64Flag + imageStr\r\n                    }\r\n                    catch{\r\n                        actualImage = '';\r\n                    }\r\n                    return(\r\n                        <tr key={detail._id}>\r\n                            <td className=\"w-25 p-3\">{detail.description}</td>\r\n                            <td className=\"w-25 p-3\">{detail.date.substring(0,10)}</td>\r\n                            <td className=\"w-25 p-3\">\r\n                                <a className=\"lightbox\" href={`#${actualImage}`}>\r\n                                    <img src={actualImage}/>\r\n                                </a> \r\n                                <div className=\"lightbox-target\" id={actualImage}>\r\n                                    <img src={actualImage}/>\r\n                                    <a className=\"lightbox-close\" href=\"#\" />\r\n                                </div>\r\n                            </td>\r\n                            <td className=\"w-25 p-3\">\r\n                                <Link to={\"/admin/dashboard/detail/edit/\"+detail._id}>edit</Link> \r\n                                |\r\n                                <a href=\"/admin/dashboard\" onClick={(e) => deleteDetail(e, detail._id, imageID )}>delete</a>  <a id=\"info\"></a>\r\n                            </td>\r\n                        </tr>\r\n                    )\r\n                })\r\n            return(detail)\r\n        }\r\n\r\n        function Subject(props) {\r\n            const subject = \r\n            subjects\r\n                .filter( subject => subject.username === props.user)\r\n                .map( subject =>\r\n                    <div key={subject._id}>\r\n                        <h5 >{subject.subject}</h5>\r\n                        <table className=\"table\">\r\n                            <tbody>\r\n                                <Detail user={props.user} subject={subject.subject} />\r\n                            </tbody>\r\n                        </table>\r\n                        <br />\r\n                    </div>\r\n                    )\r\n            return(subject)\r\n        }\r\n\r\n        const user = users.map(user => \r\n            <div key={user.username}>\r\n                <h1 >{user.username}</h1>\r\n                <Subject user={user.username} />\r\n                \r\n                <br />\r\n            </div>\r\n            )\r\n\r\n        return (\r\n            <div>\r\n                <div style={{textAlign:\"center\"}}>\r\n                    <Link to={\"/admin/user/add\"}>+User</Link>\r\n                    <Link to={\"/admin/subject/add\"}>+Subject</Link>\r\n                    <Link to={\"/admin/detail/add\"}>+Detail</Link>\r\n                </div>\r\n                {user}\r\n            </div>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}